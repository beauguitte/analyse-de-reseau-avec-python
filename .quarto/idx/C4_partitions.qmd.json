{"title":"Partitionner","markdown":{"headingText":"Partitionner","containsRefs":false,"markdown":"\n```{python}\n#| echo: false\nimport pandas as pd                # manipulation de tableaux\nimport networkx as nx              # analyse de réseau\nimport numpy as np                 # statistiques\nimport matplotlib.pyplot as plt    # visualisation\nsommets = pd.read_csv(\"data/som_d13.csv\", sep = \";\")\nliens = pd.read_csv(\"data/liens_d13.csv\", sep = \";\")\nsommets[['CODGEO']] = sommets[['CODGEO']].astype('string')\nsommets[['MARS']] = sommets[['MARS']].astype('bool')\nliens[['Origine']] = liens[['Origine']].astype('string')\nliens[['Arrivee']] = liens[['Arrivee']].astype('string')\nG = nx.from_pandas_edgelist(liens,source = \"Origine\",target = \"Arrivee\", edge_attr=\"weight\",create_using=nx.DiGraph()) \nCC = sorted(nx.weakly_connected_components(G),key=len,reverse=True) \nGD = G.subgraph(CC[0])\nGU = nx.create_empty_copy(GD, with_data=True)\nGU = nx.to_undirected(GU)\nlist(list(GU.nodes(data=True))[0][-1].keys())\nGU = nx.Graph(GU)\nGU.add_edges_from(GD.edges(), weight=0)\nfor u, v, d in GD.edges(data=True):\n    GU[u][v]['weight'] += d['weight']\n```\n\n## Cliques et k-cores\n\nLa page de la documentation consacrée aux [cliques](https://networkx.org/documentation/stable/reference/algorithms/clique.html) propose x fonctions dont plusieurs sont obsolotètes. Par défaut, `NetworkX` renvoit tous les ous-graphes complets d'ordre 1 à **n**, **n** correspondant au sous-graphe maximal complet et donc à la clique au sens strict du terme.\n\n```{python}\n# cliques d'ordre 1 à n\nprint(\"Nombre de `cliques' : \", sum(1 for c in nx.find_cliques(GU)))\nprint(\"Nombre de sommets dans la plus grande clique : \", max(len(c) for c in nx.find_cliques(GU)))\nprint(\"Composition de la plus grande clique \\n\", max(nx.find_cliques(GU), key=len))\n```\n\nNombre de variations des **k-cores** sont proposées (k-shell, k-crust, k-corona...), elles seront abordées dans une version ultérieure de ce tutoriel.\n\n```{python}\n# ordre des k-cores\nprint(list(nx.k_components(GU)))\n\n# composition du 8-core\nlist(nx.k_core(GU, k = 8))\n```\n\n## Blockmodel\n\n`NetworkX` ne semble pas proposer de méthodes de blockmodeling. La documentation fournit [un script](https://networkx.org/documentation/stable/auto_examples/algorithms/plot_blockmodel.html) créant une partition des sommets créée par une CAH sur la matrice d'adjacence. \n\n<!-- v2 :`quotient_graph`, stochastic_block_model` -->\n\n## Détection de communautés\n\nPlusieurs méthodes de détection de communautés sont implémentées dans le sous-module `community`. Seule la mesure de la modularité semble disponible pour évaluer la qualité de la partition obtenue.\n\n```{python}\n# détection de communautés\nlouv = nx.community.louvain_communities(GU, seed=123)\nprint(\"nb de communautés (louvain) :\", len(louv))\nlouv[1]\n\n#mesure de la modularité\nprint(\"modularité (louvain) : \", round(nx.community.modularity(GU, louv),2))\n\n# algorithme maximisant la modularité\ngreed = nx.community.greedy_modularity_communities(GD)\nprint(\"nb de communautés (greedy mod.) :\", len(greed))\nprint(\"modularité (greedy mod.) : \", round(nx.community.modularity(GD, greed),2))\n```\n\nLes lignes qui suivent anticipent sur la section suivante et indiquent comment visualiser les communautés détectées. La première étape est de créer un dictionnaire attribuant à chaque sommet la communauté d'appartenance détectée avec l'algorithme utilisé. \n\n```{python}\n# création d'un dictionnaire vide\nlouvain_dict = {} \n\n# boucle qui remplit le dictionnaire\nfor i,c in enumerate(louv): \n    for CODGEO in c: \n        louvain_dict[CODGEO] = i\n        \n# ligne optionnelle pour ajouter cet attribut \n# nx.set_node_attributes(GD, louvain_dict, 'louvain')\n\n# choix de l'algorithme de placement des sommets\npos = nx.spring_layout(GU)\n\n# importation d'une palette de couleurs \n# nb de couleurs égal au nombre de classes + 1 (Python commence à 0)\ncmap = plt.get_cmap('Paired', max(louvain_dict.values()) + 1)\n\n# visualisation des sommets\nnx.draw_networkx_nodes(GU,   # sommets à visualiser\n                       pos,  # placement\n                       louvain_dict.keys(),  # identifiants\n                       node_size=40,         # taille \n                       cmap=cmap,            # palette de couleur\n                       node_color=list(louvain_dict.values())) # affecter une couleur différente pour chaque classe\nnx.draw_networkx_edges(GU, \n                       pos, \n                       alpha=0.5)  # transparence\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"C4_partitions.html"},"language":{"title-block-author-single":"Auteur","title-block-published":"Mis en ligne le"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.189","bibliography":["references.bib"],"csl":"universite-de-montreal-apa.csl","toc-title":"Sommaire","date-format":"DD MM YYYY","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"C4_partitions.pdf"},"language":{"title-block-author-single":"Auteur","title-block-published":"Mis en ligne le"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"csl":"universite-de-montreal-apa.csl","toc-title":"Sommaire","date-format":"DD MM YYYY","editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{}}}}}